<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PushMapper">

	<resultMap id="pushSelectMap" type="push">
	
		<result property="pushId" 				column="push_id" 			jdbcType="NUMERIC"/>
		<result property="pushType" 		column="push_type"		jdbcType="VARCHAR"/>
		<result property="refId" 					column="ref_id"					jdbcType="VARCHAR"/>
		<result property="pushTime" 		column="push_date"		jdbcType="TIMESTAMP"/>
		<result property="read" 					column="read" 					jdbcType="CHAR"/>
		<result property="receiverId" 		column="receiver_id"		jdbcType="VARCHAR"/>
		<result property="cmtCount" 			column="cmt_count" 		jdbcType="INTEGER"/>
		
	</resultMap>
	
  	
	<insert id="addPush" parameterType="push">
		INSERT INTO push (push_id, push_type, ref_id, push_date, read, receiver_id)
		VALUES (seq_push_id.NEXTVAL, #{pushType}, #{refId}, SYSTIMESTAMP, 'F', #{receiverId} )
	</insert>
	
	<sql id="select-pushList">
		SELECT  push_id, push_type, ref_id, push_date, read, cmtCount
		FROM push
		WHERE receiver_id = #{receiverId}
		ORDER BY push_date DESC
	</sql>
	
	<select id="getPushId" parameterType="push" resultMap="basketSelectMap">
		SELECT push_id
		FROM push
		WHERE ref_id = #{refId} AND receiver_id = #{receiverId}
	</select>
	
	<select id ="getCmtCount" parameterType = "push" resultType="push">
		SELECT cmt_count
		FROM push
		WHERE ref_id = #{refId} AND receiver_id = #{receiverId}
	</select>
	
	<update id ="readPush" parameterType = "push">
		UPDATE push
		SET read = 'T'
		WHERE push_id = #{pushId}
	</update>
	
	
	<select  id="getPushList"  parameterType="map"	resultMap="pushSelectMap">
  		SELECT * FROM
  						(	SELECT inner_table.* , ROWNUM AS row_seq
  							FROM		(	<include refid="select-basketList"/> 	) inner_table
							WHERE ROWNUM <![CDATA[ <=]]> #{search.endRowNum}	)
		WHERE row_seq BETWEEN #{search.startRowNum} AND #{search.endRowNum} 
	</select>
	
	
	<update id = "deletePush">
		UPDATE push
		SET read = 'T'
		WHERE push_id IN
		<foreach collection="list" item="item" open="(" close=")" separator=",">#{pushId}</foreach>
	</update>
	
	 
	 <select  id="getTotalCount"  parameterType="map"	 resultType="int">
	  	SELECT COUNT(*)
	  	FROM(	
	  		<include refid="select-pushList"/>
	  	 ) countTable						
	</select>
	 
	 
	
</mapper>